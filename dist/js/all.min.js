getScreenMedia(function(e,r){e?alert("NÃ£o foi possivel obter a tela"):getElementById("localVideo").src=window.URL.createObjectURL(r)});var getUserMedia=require("getusermedia"),cache={};module.exports=function(e,r){var a,o=2===arguments.length,i=o?r:e;if("undefined"==typeof window||"http:"===window.location.protocol)return a=new Error("NavigatorUserMediaError"),a.name="HTTPS_REQUIRED",i(a);if(window.navigator.userAgent.match("Chrome")){var n=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33,d=!window.chrome.webstore;if(window.navigator.userAgent.match("Linux")&&(t=35),sessionStorage.getScreenMediaJSExtensionId)chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(r){if(r&&""!==r.sourceId)e=o&&e||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},e.video.mandatory.chromeMediaSourceId=r.sourceId,getUserMedia(e,i);else{var a=new Error("NavigatorUserMediaError");a.name="PERMISSION_DENIED",i(a)}});else if(window.cefGetScreenMedia)window.cefGetScreenMedia(function(r){if(r)e=o&&e||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},e.video.mandatory.chromeMediaSourceId=r,getUserMedia(e,i);else{var a=new Error("cefGetScreenMediaError");a.name="CEF_GETSCREENMEDIA_CANCELED",i(a)}});else if(d||n>=26&&t>=n)e=o&&e||{video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},getUserMedia(e,i);else{var c=window.setTimeout(function(){return a=new Error("NavigatorUserMediaError"),a.name="EXTENSION_UNAVAILABLE",i(a)},1e3);cache[c]=[i,o?e:null],window.postMessage({type:"getScreen",id:c},"*")}}else if(window.navigator.userAgent.match("Firefox")){var s=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);s>=33?(e=o&&e||{video:{mozMediaSource:"window",mediaSource:"window"}},getUserMedia(e,function(e,r){if(i(e,r),!e)var a=r.currentTime,o=window.setInterval(function(){r||window.clearInterval(o),r.currentTime==a&&(window.clearInterval(o),r.onended&&r.onended()),a=r.currentTime},500)})):(a=new Error("NavigatorUserMediaError"),a.name="EXTENSION_UNAVAILABLE")}},window.addEventListener("message",function(e){if(e.origin==window.location.origin)if("gotScreen"==e.data.type&&cache[e.data.id]){var r=cache[e.data.id],a=r[1],o=r[0];if(delete cache[e.data.id],""===e.data.sourceId){var i=new Error("NavigatorUserMediaError");i.name="PERMISSION_DENIED",o(i)}else a=a||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},a.video.mandatory.chromeMediaSourceId=e.data.sourceId,getUserMedia(a,o)}else"getScreenPending"==e.data.type&&window.clearTimeout(e.data.id)});